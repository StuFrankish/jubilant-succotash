@{
    ViewData["Title"] = "Home Page";
}

<pre style="background-color: #f8f8f8;padding: 10px;border-radius: 10px;box-shadow: 0 0 5px #9E9E9E; color: #3F51B5; margin-bottom: 50px;">
<b>Pre-text:</b>
This side-project is an exercise in creating a markdown editor that mimics the markdown editor used oh GitHub.
I will use this repo as the basis for creating a new vue component that can be dropped in and pointed at some endpoint to render html from the written markdown.
</pre>
<!-- Include Bootstrap CSS -->
<link rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />

<link href="~/lib/font-awesome/css/fontawesome.min.css" rel="stylesheet" />
<link href="~/lib/font-awesome/css/all.min.css" rel="stylesheet" />

<style>
    /* Custom styles */

    .nav.nav-tabs {
        position: relative;
        left: -1px;
        top: -1px;
        background-color: #f6f8fa;
    }

    a.nav-link {
        font-size: 0.8rem;
    }

        a.nav-link:not(.active) {
            color: #9e9e9e;
        }

            a.nav-link:not(.active):hover {
                border-color: transparent !important;
            }

    li.nav-item.ml-auto {
        padding: 2px;
    }

    .icon-buttons button {
        color: #757575;
    }
    .icon-buttons .separator {
        display: inline-block;
        width: 1px;
        background-color: #ced4da;
        height: 1rem;
        position: relative;
        top: 4px;
    }

    .markdown-editor {
        border-radius: 5px;
        border: 1px solid #ced4da;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
        background-color: #fff;
        resize: vertical;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 150px;
        height: 150px;
    }

    .editor-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin: 0;
        padding: 0;
    }

    .tab-pane {
        flex: 1;
        display: flex;
        flex-direction: column;
        margin: 0;
        padding: 0;
    }

    .editor-textarea,
    .editor-preview {
        height: 100%;
        width: 100%;
        margin: 0;
        padding: 8px;
        border: none;
        outline: none;
        resize: none;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
        font-size: 14px;
        overflow: auto;
    }

    .editor-preview {
        background-color: #ffffff;
    }
</style>

<div class="markdown-editor">
    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="editorTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active"
               id="write-tab"
               data-toggle="tab"
               href="#write"
               role="tab"
               aria-controls="write"
               aria-selected="true">Write</a>
        </li>
        <li class="nav-item">
            <a class="nav-link"
               id="preview-tab"
               data-toggle="tab"
               href="#preview"
               role="tab"
               aria-controls="preview"
               aria-selected="false">Preview</a>
        </li>
        <li class="nav-item ml-auto">
            
            <div class="icon-buttons">
                <!-- Icon-only buttons -->
                <button class="btn btn-light btn-sm" data-command="bold">
                    <i class="fa-solid fa-bold"></i>
                </button>
                <button class="btn btn-light btn-sm" data-command="italic">
                    <i class="fa-solid fa-italic"></i>
                </button>
                <button class="btn btn-light btn-sm" data-command="heading">
                    <i class="fa-solid fa-heading"></i>
                </button>
                <div class="separator"></div>
                <button class="btn btn-light btn-sm" data-command="link">
                    <i class="fa-solid fa-link"></i>
                </button>
                <!-- Add more buttons as needed -->
            </div>

        </li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content editor-content">
        <div class="tab-pane show active"
             id="write"
             role="tabpanel"
             aria-labelledby="write-tab">
            <textarea class="editor-textarea" placeholder="Use Markdown to format your comment"></textarea>
        </div>
        <div class="tab-pane"
             id="preview"
             role="tabpanel"
             aria-labelledby="preview-tab">
            <div class="editor-preview"></div>
        </div>
    </div>
</div>

<!-- Include jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    (function() {
        const textarea = document.querySelector('.editor-textarea');
        const preview = document.querySelector('.editor-preview');
        const editorButtons = document.querySelectorAll('[data-command]');

        // Handle tab change event
        $('a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
            if (e.target.id === 'preview-tab') {

                // Hide the icon buttons when using preview mode
                $(editorButtons).parent().hide();

                // Simple markdown to HTML conversion
                let markdownText = textarea.value;
                // Replace **text** with bold
                markdownText = markdownText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                // Replace *text* with italics
                markdownText = markdownText.replace(/\*(.*?)\*/g, '<em>$1</em>');
                // Replace # Header with h1
                markdownText = markdownText.replace(/^# (.*$)/gim, '<h1>$1</h1>');
                // Replace ## Header with h2
                markdownText = markdownText.replace(/^## (.*$)/gim, '<h2>$1</h2>');
                // Replace ### Header with h3
                markdownText = markdownText.replace(/^### (.*$)/gim, '<h3>$1</h3>');
                // Replace > quote with blockquote
                markdownText = markdownText.replace(/^> (.*$)/gim, '<blockquote>$1</blockquote>');
                // Replace line breaks
                markdownText = markdownText.replace(/\n/g, '<br>');
                preview.innerHTML = markdownText;

                // If the markdown text is empty, replace the contents with a placeholder "nothing to preview"
                if (markdownText === '') {
                    preview.innerHTML = 'Nothing to preview';
                }
            }
            else {
                // Show the icon buttons when using edit mode
                $(editorButtons).parent().show();
            }
        });

        editorButtons.forEach((button) => {
            button.addEventListener('click', () => {
                const command = button.getAttribute('data-command');
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const selectedText = textarea.value.substring(start, end);
                let replacement = selectedText;

                if (command === 'bold') {
                    replacement = `**${selectedText}**`;
                } else if (command === 'italic') {
                    replacement = `*${selectedText}*`;
                } else if (command === 'heading') {
                    replacement = `### ${selectedText}`;
                }

                textarea.setRangeText(replacement, start, end, 'end');
                textarea.focus();
            });
        });
    })();
</script>
